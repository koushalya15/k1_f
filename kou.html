<!DOCTYPE html>
<html>
<head>
    <title>Secure Auto Person Gallery</title>

<style>
    body { font-family: Arial; background:#f2f2f2; margin:0; }
    button {
        padding: 8px 12px; border:none; border-radius:5px;
        background: #4CAF50; color:white; cursor:pointer; margin:5px;
    }
    button:hover { background:#45a049; }

    .photo-box {
        display:inline-block; margin:10px; padding:10px;
        background:white; border-radius:10px; box-shadow:0 0 5px black;
        text-align:center;
    }
    .photo-box img { width:200px; border-radius:10px; }

    .delete-btn { background:red; }
    .add-btn { background:blue; }
    .main-btn { background:purple; }
    .person-box img { width:150px; margin:10px; border-radius:10px; }
</style>

</head>
<body>

<!-- LOGIN -->
<section id="loginSection">
    <div style="text-align:center; padding-top:50px;">
        <h2>Secure Login</h2>
        <input id="username" placeholder="Username"><br><br>
        <input id="password" placeholder="Password" type="password"><br>
        <button onclick="login()">Login</button>
    </div>
</section>

<!-- GALLERY -->
<section id="gallery" style="display:none; text-align:center;">
    <h2>Persons</h2>

    <button onclick="openAddPerson()">➕ Add Person</button>
    <input type="file" id="addPersonInput" style="display:none;" accept="image/*">

    <div id="galleryContainer"></div>
</section>

<!-- PERSON PHOTOS -->
<section id="personPhotos" style="display:none; text-align:center;">
    <h2 id="personTitle"></h2>

    <input type="file" id="addPhotoInput" style="display:none;" accept="image/*">
    <input type="file" id="mainPhotoInput" style="display:none;" accept="image/*">

    <div id="photosContainer"></div>

    <button onclick="goBack()">Back</button>
</section>

<script>

/* ============================
   DEVICE LOCK SECURITY
============================ */

let DEVICE_KEY = "MY_DEVICE_987654";
let storedKey = localStorage.getItem("device_lock_key");

// If device key not found → create unique key for THIS device only
if (!storedKey) {
    localStorage.setItem("device_lock_key", DEVICE_KEY);
} else {
    // If someone else opens file on another device → storedKey = null
    // So they will NEVER see your photos
}

/* ============ LOGIN ============ */
function login() {
    if (username.value === "admin" && password.value === "1234") {

        let dk = localStorage.getItem("device_lock_key");

        if (dk !== DEVICE_KEY) {
            alert("This gallery is locked to the owner's device. Access Denied.");
            return;
        }

        document.getElementById("loginSection").style.display = "none";
        document.getElementById("gallery").style.display = "block";
        loadGallery();
    } else {
        alert("Incorrect Login");
    }
}

/* ============ PERSON STORAGE ============ */
function getPersons() {
    if (localStorage.getItem("device_lock_key") !== DEVICE_KEY) return [];
    let saved = localStorage.getItem("persons");
    return saved ? JSON.parse(saved) : [];
}

function savePersons(list) {
    if (localStorage.getItem("device_lock_key") !== DEVICE_KEY) return;
    localStorage.setItem("persons", JSON.stringify(list));
}

/* ============ MAIN PHOTO ============ */
function getMainPhoto(id) {
    if (localStorage.getItem("device_lock_key") !== DEVICE_KEY) return "";
    return localStorage.getItem("mainPhoto_" + id) || "default_main.jpeg";
}
function saveMainPhoto(id, img) {
    if (localStorage.getItem("device_lock_key") !== DEVICE_KEY) return;
    localStorage.setItem("mainPhoto_" + id, img);
}

/* ============ OTHER PHOTOS ============ */
function getPhotos(id) {
    if (localStorage.getItem("device_lock_key") !== DEVICE_KEY) return [];
    let saved = localStorage.getItem("photos_" + id);
    return saved ? JSON.parse(saved) : [];
}
function savePhotos(id, list) {
    if (localStorage.getItem("device_lock_key") !== DEVICE_KEY) return;
    localStorage.setItem("photos_" + id, JSON.stringify(list));
}

/* ============ LOAD GALLERY ============ */
function loadGallery() {
    let persons = getPersons();
    let box = document.getElementById("galleryContainer");
    box.innerHTML = "";

    persons.forEach(p => {
        box.innerHTML += `
            <div class="person-box">
                <img src="${getMainPhoto(p)}" onclick="showPerson(${p})">
                <p>Person ${p}</p>
            </div>
        `;
    });
}

/* ============ ADD NEW PERSON ============ */
function openAddPerson() {
    document.getElementById("addPersonInput").click();
}

document.getElementById("addPersonInput").addEventListener("change", function(event) {
    let file = event.target.files[0];
    if (!file) return;

    let reader = new FileReader();
    reader.onload = function(e) {

        let persons = getPersons();
        let newId = persons.length === 0 ? 1 : Math.max(...persons) + 1;

        persons.push(newId);
        savePersons(persons);

        saveMainPhoto(newId, e.target.result);

        loadGallery();
        alert("Person Added Successfully!");
    };
    reader.readAsDataURL(file);
});

/* ============ OPEN PERSON ============ */
let currentPerson = null;

function showPerson(id) {
    currentPerson = id;

    document.getElementById("gallery").style.display = "none";
    document.getElementById("personPhotos").style.display = "block";

    document.getElementById("personTitle").innerText = "Person " + id;

    loadPhotos();
}

/* ============ LOAD PHOTOS ============ */
function loadPhotos() {
    let container = document.getElementById("photosContainer");
    container.innerHTML = "";

    container.innerHTML += `
        <div class="photo-box">
            <h3>Main Photo</h3>
            <img src="${getMainPhoto(currentPerson)}">
            <br>
            <button class="main-btn" onclick="openMainUpload()">Change Main Photo</button>
        </div>
    `;

    let photos = getPhotos(currentPerson);
    photos.forEach((photo, index) => {
        container.innerHTML += `
            <div class="photo-box">
                <img src="${photo}">
                <br>
                <button class="delete-btn" onclick="deletePhoto(${index})">Delete</button>
            </div>
        `;
    });

    container.innerHTML += `
        <div class="photo-box">
            <button class="add-btn" onclick="openAddPhoto()">Add Photo</button>
        </div>
    `;
}

/* ============ DELETE PHOTO ============ */
function deletePhoto(index) {
    let photos = getPhotos(currentPerson);
    photos.splice(index, 1);
    savePhotos(currentPerson, photos);
    loadPhotos();
}

/* ============ ADD PHOTO ============ */
function openAddPhoto() {
    document.getElementById("addPhotoInput").click();
}

document.getElementById("addPhotoInput").addEventListener("change", function(event) {
    let file = event.target.files[0];
    if (!file) return;

    let reader = new FileReader();
    reader.onload = function(e) {
        let photos = getPhotos(currentPerson);
        photos.push(e.target.result);
        savePhotos(currentPerson, photos);
        loadPhotos();
    };
    reader.readAsDataURL(file);
});

/* ============ CHANGE MAIN PHOTO ============ */
function openMainUpload() {
    document.getElementById("mainPhotoInput").click();
}

document.getElementById("mainPhotoInput").addEventListener("change", function(event) {
    let file = event.target.files[0];
    if (!file) return;

    let reader = new FileReader();
    reader.onload = function(e) {
        saveMainPhoto(currentPerson, e.target.result);
        loadPhotos();
        loadGallery();
    };
    reader.readAsDataURL(file);
});

/* ============ BACK ============ */
function goBack() {
    document.getElementById("personPhotos").style.display = "none";
    document.getElementById("gallery").style.display = "block";
}

</script>

</body>
</html>
